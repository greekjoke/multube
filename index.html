<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="max-age=3600, must-revalidate" />    
  <title>MulTube</title>
  <script src="https://code.jquery.com/jquery-2.2.4.min.js"
    integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
    crossorigin="anonymous"></script>
  <script src="https://www.youtube.com/iframe_api"></script>       
  <script src="app.js"></script>
  <script src="draggable.js"></script>
  <script src="task.js"></script>
  <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">  
  <link rel="stylesheet" href="style.css">    
  <link rel="icon" type="image/ico" href="favicon.ico"/>  
</head>

<body>
  <header>
    <div id="logo"><img src="media/logo.svg"/></div>
    <div id="title"><h1>MulTube</h1></div>

    <!-- main menu -->
    <div id="topmenu" class="menu">
      <ul>
        <li>
          <b>Task</b>
          <ul>
            <li action="addTaskYt">Add Youtube video</li>
            <li action="addTaskAudio">Add audio file</li>
            <li action="addTaskText">Add text reading</li>
            <li action="addTaskPic">Add picture</li>
            <li action="addTaskFrame">Add iFrame</li>
            <li action="removeAllTasks">Remove all</li>
          </ul>
        </li>
        <li>
          <b>Preset</b>
          <ul>
            <li action="addPreset">Add preset</li>
            <li action="removePreset">Remove current</li>
            <li>
              <b>List</b>
              <ul action="switchPreset">
                <li data-id="default">Default</li>                
              </ul>
            </li>            
          </ul>
        </li>
        <li>
          <b>Settings</b>
          <ul>
            <li action="settingsToFile">Export to file</li>
            <li action="settingsFromFile">Import from file</li>            
            <li>
              <b>Color scheme</b>              
              <ul action="switchColors">               
                <li data-id="default">Light</li>
                <li data-id="dark">Dark</li>
              </ul>
            </li>            
          </ul>          
        </li>
        <li><b><a target="_blank" href="https://greekjoke.github.io/multube/readme.md">Help</a></b></li>
      </ul>
      <!-- /main menu -->

    </div>
    <div id="gctrl">      
      <i action="gcStop" title="Stop playing" class="button fa-solid fa-stop"></i>
      <i action="gcPlay" title="Play together" class="button fa-solid fa-play"></i>
      <i action="gcPause" title="Pause" class="button fa-solid fa-pause"></i>
      <i action="gcMute" title="Mute all" class="button fa-solid fa-volume-xmark"></i>
      <i action="gcUnmute" title="Unmute all" class="button fa-solid fa-volume-high"></i>
      <i action="gcRewindRand" title="Rewind to random position" class="button fa-solid fa-shuffle"></i>
      <span class="menu" id="gcMenuSpeed">
        <ul>
          <li>
            <i title="Speed control" class="fa-solid fa-clock-rotate-left"></i>
            <ul action="gcSpeed">
              <li data-id="0.25">0.25</li>
              <li data-id="0.5">0.5</li>
              <li data-id="0.75">0.75</li>
              <li data-id="1.0">Normal</li>
              <li data-id="1.25">1.25</li>
              <li data-id="1.5">1.5</li>
              <li data-id="1.75">1.75</li>
              <li data-id="2.0">2</li>
            </ul>
          </li>
        </ul>          
      </span>      
    </div>
  </header>  

  <script type="text/template" id="tpl-task">
    <div class="task draggable drop-receiver">
      <div class="bar handle">
        <span class="icon"><i class="fa-solid fa-flask"></i></span>
        <span class="title">Untitled</span>
        <span class="status"><i class="fa-solid fa-battery-three-quarters"></i></span>
        <span class="settings menu">
            <ul>
              <li>
                <i class="fa-solid fa-gear"></i>
                <ul>
                  <li action="taskCmd" data-id="remove">Remove</li>
                </ul>
              </li>
            </ul>          
        </span>
        <span class="remove" action="taskCmd" data-id="remove"><i class="fa-solid fa-xmark"></i></span>
      </div>
      <div class="content">empty</div>
    </div> 
  </script>

  <div id="widgets">        
    <div class="placeholder">No any tasks here yet</div>

    <!--
    <div class="task draggable drop-receiver" id="task1">
      <div class="bar handle">
        <span class="icon"><i class="fa-solid fa-flask"></i></span>
        <span class="title">Untitled</span>
        <span class="status"><i class="fa-solid fa-battery-three-quarters"></i></span>
        <span class="settings menu">                    
            <ul>
              <li>
                <i class="fa-solid fa-gear"></i>
                <ul>
                  <li action="taskCmd" data-id="alpha">Alpha</li>
                  <li action="taskCmd" data-id="betta">Betta</li>
                  <li action="taskCmd" data-id="gamma">Gamma</li>
                </ul>
              </li>
            </ul>          
        </span>
        <span class="remove"><i class="fa-solid fa-xmark"></i></span>
      </div>
      <div class="content">
        #1
      </div>
    </div>      

    <div class="task draggable drop-receiver" id="task2">
      <div class="bar">
        <span class="icon"><i class="fa-solid fa-flask"></i></span>
        <span class="title">Untitled</span>
        <span class="status"><i class="fa-solid fa-battery-three-quarters"></i></span>        
        <span class="remove"><i class="fa-solid fa-xmark"></i></span>
      </div>
      <div class="content">
        #2
      </div>
    </div>
    
    <div class="task draggable drop-receiver"  id="task3">
      <div class="bar">
        <span class="icon"><i class="fa-solid fa-flask"></i></span>
        <span class="title">Untitled</span>
        <span class="status"><i class="fa-solid fa-battery-three-quarters"></i></span>        
        <span class="remove"><i class="fa-solid fa-xmark"></i></span>
      </div>
      <div class="content">
        #3
      </div>
    </div>
    
    <div class="task draggable drop-receiver" id="task4">
      <div class="bar">
        <span class="icon"><i class="fa-solid fa-flask"></i></span>
        <span class="title">Untitled</span>
        <span class="status"><i class="fa-solid fa-battery-three-quarters"></i></span>        
        <span class="remove"><i class="fa-solid fa-xmark"></i></span>
      </div>
      <div class="content">
        #4
      </div>
    </div>  
    -->    
    
  </div>
</body>

<script>
  $(document).ready(function() {
    MtApp.init();

    var view = $('#widgets');
    window.MtDraggable(view, {
          sorting: true,
          sortHoriz: true,
          onDrop: function (movId, recv) {
              const target = $('#' + movId);

              if (target.length != 1) {
                  console.error('drop target not found', movId, recv);
                  return;
              }

              const dropBefore = recv.hasClass('drop-before');

              // вставляем в дерево
              if (dropBefore) {
                  target.insertBefore(recv);
              } else {
                  target.insertAfter(recv);
              }

              // TODO: пересчитываем массив задач и сохраняем настройки

          }
      });

      $('body').click(function(ev) {
        const elem = $(ev.target);
        const id = elem.attr('data-id');
        let act = elem.attr('action');        
        if (!act && !id) return;
        if (!act) act = elem.parent().attr('action');
        if (!act) return;
        console.log('action', act, id);
      });


  });
</script>

</html>
